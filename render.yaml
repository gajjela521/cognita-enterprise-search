services:
  # 1. Java API Gateway
  - type: web
    name: cognita-api-gateway
    env: java
    rootDir: cognita-api-gateway
    region: oregon
    plan: free
    buildCommand: "./gradlew clean build -x test"
    startCommand: "java -jar build/libs/cognita-api-gateway-0.0.1-SNAPSHOT.jar"
    envVars:
      - key: SPRING_PROFILES_ACTIVE
        value: prod
      - key: VECTOR_SERVICE_URL
        fromService:
          type: web
          name: cognita-vector-service
          property: url
    healthCheckPath: /api/health

  # 2. Python Vector Service
  - type: web
    name: cognita-vector-service
    env: python
    rootDir: cognita-vector-service
    region: oregon
    plan: free
    buildCommand: "pip install -r requirements.txt && python src/indexer.py"
    startCommand: "gunicorn server:app"
    envVars:
      - key: PYTHON_VERSION
        value: 3.10.0
